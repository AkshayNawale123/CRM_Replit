import React, { useState } from 'react';
import { Clock, Search, ChevronDown, ChevronUp } from 'lucide-react';

const PipelineStageTable = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [sortColumn, setSortColumn] = useState(null);
  const [sortDirection, setSortDirection] = useState('asc');

  const tableData = [
    {
      stage: "Lead",
      statuses: ["None", "Awaiting Response"],
      waitTime: "24-48 hours",
      waitDays: 1,
      action: "Immediate follow-up required after initial contact"
    },
    {
      stage: "Qualified",
      statuses: ["Under Evaluation", "Pending Review"],
      waitTime: "2-3 days",
      waitDays: 2.5,
      action: "Allow time for internal stakeholder alignment"
    },
    {
      stage: "Meeting Scheduled",
      statuses: ["Awaiting Response"],
      waitTime: "1-5 days",
      waitDays: 3,
      action: "Wait for meeting confirmation or reschedule"
    },
    {
      stage: "Demo Completed",
      statuses: ["Under Evaluation", "Awaiting Response"],
      waitTime: "3-5 days",
      waitDays: 4,
      action: "Give time to assess demo and discuss internally"
    },
    {
      stage: "Proof of Concept (POC)",
      statuses: ["In Negotiation", "Under Evaluation", "Pending Review"],
      waitTime: "1-3 weeks",
      waitDays: 14,
      action: "Technical validation period - check weekly"
    },
    {
      stage: "Proposal Sent",
      statuses: ["Pending Review", "Under Evaluation", "On Hold"],
      waitTime: "5-7 days",
      waitDays: 6,
      action: "Proposal review and comparison with alternatives"
    },
    {
      stage: "Verbal Commitment",
      statuses: ["Budget Approval Pending", "Pending Review"],
      waitTime: "3-5 days",
      waitDays: 4,
      action: "Awaiting formal approval and budget sign-off"
    },
    {
      stage: "Contract Review",
      statuses: ["In Negotiation", "Pending Review", "On Hold"],
      waitTime: "5-10 days",
      waitDays: 7.5,
      action: "Legal review and terms negotiation"
    },
    {
      stage: "Won",
      statuses: ["None"],
      waitTime: "N/A",
      waitDays: 0,
      action: "Contract signed - begin onboarding process"
    },
    {
      stage: "Lost",
      statuses: ["Proposal Rejected", "On Hold"],
      waitTime: "N/A",
      waitDays: 0,
      action: "Document learnings and maintain relationship"
    }
  ];

  const getWaitTimeColor = (waitTime) => {
    if (waitTime === "N/A") return "text-gray-500 bg-gray-50";
    if (waitTime.includes("hours") || waitTime.includes("1-3 days") || waitTime.includes("2-3 days")) 
      return "text-green-700 bg-green-50";
    if (waitTime.includes("week")) return "text-orange-700 bg-orange-50";
    return "text-blue-700 bg-blue-50";
  };

  const handleSort = (column) => {
    if (sortColumn === column) {
      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');
    } else {
      setSortColumn(column);
      setSortDirection('asc');
    }
  };

  const filteredData = tableData.filter(row => 
    row.stage.toLowerCase().includes(searchTerm.toLowerCase()) ||
    row.statuses.some(s => s.toLowerCase().includes(searchTerm.toLowerCase())) ||
    row.waitTime.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const sortedData = [...filteredData].sort((a, b) => {
    if (!sortColumn) return 0;
    
    let aValue = a[sortColumn];
    let bValue = b[sortColumn];
    
    if (sortColumn === 'statuses') {
      aValue = a.statuses.length;
      bValue = b.statuses.length;
    }
    
    if (sortDirection === 'asc') {
      return aValue > bValue ? 1 : -1;
    } else {
      return aValue < bValue ? 1 : -1;
    }
  });

  return (
    <div className="w-full max-w-6xl mx-auto p-6 bg-gray-50 min-h-screen">
      <div className="mb-6">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Pipeline Stage Reference Guide</h1>
        <p className="text-gray-600">Complete breakdown of stages, statuses, and ideal wait times</p>
      </div>

      {/* Search Bar */}
      <div className="mb-4 relative">
        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
        <input
          type="text"
          placeholder="Search stages, statuses, or wait times..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        />
      </div>

      {/* Table */}
      <div className="bg-white rounded-lg shadow-md overflow-hidden border border-gray-200">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
              <tr>
                <th 
                  className="px-6 py-4 text-left text-sm font-semibold cursor-pointer hover:bg-blue-700 transition-colors"
                  onClick={() => handleSort('stage')}
                >
                  <div className="flex items-center gap-2">
                    Stage
                    {sortColumn === 'stage' && (
                      sortDirection === 'asc' ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />
                    )}
                  </div>
                </th>
                <th 
                  className="px-6 py-4 text-left text-sm font-semibold cursor-pointer hover:bg-blue-700 transition-colors"
                  onClick={() => handleSort('statuses')}
                >
                  <div className="flex items-center gap-2">
                    Possible Status
                    {sortColumn === 'statuses' && (
                      sortDirection === 'asc' ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />
                    )}
                  </div>
                </th>
                <th 
                  className="px-6 py-4 text-left text-sm font-semibold cursor-pointer hover:bg-blue-700 transition-colors"
                  onClick={() => handleSort('waitDays')}
                >
                  <div className="flex items-center gap-2">
                    <Clock className="w-4 h-4" />
                    Ideal Wait Time
                    {sortColumn === 'waitDays' && (
                      sortDirection === 'asc' ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />
                    )}
                  </div>
                </th>
                <th className="px-6 py-4 text-left text-sm font-semibold">
                  Action / Notes
                </th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {sortedData.map((row, index) => (
                <tr key={index} className="hover:bg-gray-50 transition-colors">
                  <td className="px-6 py-4">
                    <div className="flex items-center gap-2">
                      <div className="w-8 h-8 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center font-bold text-sm">
                        {index + 1}
                      </div>
                      <span className="font-semibold text-gray-900">{row.stage}</span>
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <div className="flex flex-wrap gap-2">
                      {row.statuses.map((status, idx) => (
                        <span
                          key={idx}
                          className="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-700 border border-purple-200"
                        >
                          {status}
                        </span>
                      ))}
                    </div>
                  </td>
                  <td className="px-6 py-4">
                    <span className={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold ${getWaitTimeColor(row.waitTime)}`}>
                      <Clock className="w-4 h-4" />
                      {row.waitTime}
                    </span>
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-600">
                    {row.action}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      {/* Summary Cards */}
      <div className="grid md:grid-cols-3 gap-4 mt-6">
        <div className="bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-200 rounded-lg p-4">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-3 h-3 rounded-full bg-green-500"></div>
            <h3 className="font-semibold text-green-900">Fast Response</h3>
          </div>
          <p className="text-sm text-green-700">Lead through Demo: 24 hours - 5 days</p>
        </div>

        <div className="bg-gradient-to-br from-orange-50 to-orange-100 border-2 border-orange-200 rounded-lg p-4">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-3 h-3 rounded-full bg-orange-500"></div>
            <h3 className="font-semibold text-orange-900">Evaluation Period</h3>
          </div>
          <p className="text-sm text-orange-700">POC & Proposal: 1-3 weeks</p>
        </div>

        <div className="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 rounded-lg p-4">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-3 h-3 rounded-full bg-blue-500"></div>
            <h3 className="font-semibold text-blue-900">Legal/Admin</h3>
          </div>
          <p className="text-sm text-blue-700">Commitment & Contract: 3-10 days</p>
        </div>
      </div>

      {/* Best Practices */}
      <div className="mt-6 bg-white rounded-lg shadow-md border border-gray-200 p-6">
        <h3 className="text-lg font-bold text-gray-900 mb-4">âš¡ Follow-up Best Practices</h3>
        <div className="grid md:grid-cols-2 gap-4 text-sm text-gray-700">
          <div className="flex items-start gap-3">
            <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs flex-shrink-0">1</div>
            <div>
              <p className="font-medium text-gray-900">After Wait Period Expires</p>
              <p className="text-gray-600">Follow up immediately with value-added content</p>
            </div>
          </div>
          <div className="flex items-start gap-3">
            <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs flex-shrink-0">2</div>
            <div>
              <p className="font-medium text-gray-900">No Response After 2-3 Attempts</p>
              <p className="text-gray-600">Reassess lead quality and priority</p>
            </div>
          </div>
          <div className="flex items-start gap-3">
            <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs flex-shrink-0">3</div>
            <div>
              <p className="font-medium text-gray-900">"On Hold" Status</p>
              <p className="text-gray-600">Weekly check-ins to maintain relationship</p>
            </div>
          </div>
          <div className="flex items-start gap-3">
            <div className="w-6 h-6 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs flex-shrink-0">4</div>
            <div>
              <p className="font-medium text-gray-900">Adjust for Deal Size</p>
              <p className="text-gray-600">Larger deals may need longer wait times</p>
            </div>
          </div>
        </div>
      </div>

      {/* Export/Print Button */}
      <div className="mt-6 flex justify-end gap-3">
        <button 
          onClick={() => window.print()}
          className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium text-sm"
        >
          Print Reference
        </button>
        <button 
          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm"
        >
          Export to CSV
        </button>
      </div>
    </div>
  );
};

export default PipelineStageTable;